---
title: CentOS7 gogs安装及二级域名nginx代理
date: 2018-02-12 16:46:57
tags: 
- Gogs
- CentOS7
categories: 
- 服务器
- git
---
## 搭建gogs服务
### 一、基础环境配置 (git和数据库)
#### 1、 git和数据库的安装
由于机器(CentOS7)上没有Git 所以先要安装git

```
yum install -y git
```
数据库安装就不演示了，本博客已经有了

#### 2、在系统上新建账号 
在系统上添加一个git的系统账号，用来启动gogs软件，这样比较好

```
root@sweet:~$ useradd git
root@sweet:~$ passwd git
```
切换到git用户，生成 ssh

```
git@sweet:~$ ssh-keygen -t rsa
```
### 二、安装gogs 
#### 1、gogs下载安装
下载对应的二进制文件 https://gogs.io/docs/installation/install_from_binary

```
[root@sweet ~]# wget https://dl.gogs.io/0.11.34/linux_amd64.tar.gz
--2018-02-17 11:31:09--  https://dl.gogs.io/0.11.34/linux_amd64.tar.gz
Resolving dl.gogs.io (dl.gogs.io)... 138.68.27.161
Connecting to dl.gogs.io (dl.gogs.io)|138.68.27.161|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 18688444 (18M) [application/x-gzip]
Saving to: ‘linux_amd64.tar.gz.1’

100%[======================================>] 18,688,444  4.33MB/s   in 4.1s

2018-02-17 11:31:15 (4.33 MB/s) - ‘linux_amd64.tar.gz.1’ saved [18688444/18688444]

```

解压文件

```
[root@sweet ~]# ls
linux_amd64.tar.gz
[root@sweet ~]# tar zxvf linux_amd64.tar.gz
```
将文件移动到 etc 目录下，并且将所有权授权给git用户

```
[root@sweet ~]# mv gogs/ /etc/
[root@sweet etc]# chown git -R gogs/
```

#### 2、数据库配置
接下来就是准备数据库配置了

1、创建数据库gogs
2、创建数据库gogs用户
3、将gogs数据库授权给gogs用户

（1）创建数据库

```
mysql -u root -p < scripts/mysql.sql
Enter password:
```
上面执行的sql其实为：

```
DROP DATABASE IF EXISTS gogs;
CREATE DATABASE IF NOT EXISTS gogs CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```
（2）创建数据库用户并授权

```
$ mysql -u root -p
Enter password:
mysql> create user 'gogs'@'localhost' identified by 'your_password';
mysql> grant all privileges on gogs.* to 'gogs'@'localhost';
mysql> flush privileges;
mysql> exit
```
（3）然后我们就可以尝试启动了，在gog文件夹下

```
[root@sweet gogs]# ./gogs web
```
启动如下图
![](https://sweetm-1256061026.cos.ap-beijing.myqcloud.com/2018-02-12-git%E6%9C%8D%E5%8A%A1%E5%99%A8gogs%E5%AE%89%E8%A3%85/gogs.jpg)

但是填好后提交出现错误，搜索之后的需要升级数据库，这块内容在另外一个博客里
最后，我们数据库搞定之后就可以看到如下界面了
![](https://sweetm-1256061026.cos.ap-beijing.myqcloud.com/2018-02-12-git%E6%9C%8D%E5%8A%A1%E5%99%A8gogs%E5%AE%89%E8%A3%85/%E9%A6%96%E9%A1%B5.jpg)
登录页面
![](https://sweetm-1256061026.cos.ap-beijing.myqcloud.com/2018-02-12-git%E6%9C%8D%E5%8A%A1%E5%99%A8gogs%E5%AE%89%E8%A3%85/%E7%99%BB%E5%BD%95.jpg)
如果你在第一次初始化的时候没有设置管理员，直接注册一个，第一个用户默认为管理员。

剩下的就不多说了，用法和github 类似。

## Nginx 二级域名反向代理
是不是每次输入一个域名后面跟着一个3000 很烦呀，没关系我们有解决的办法，那就是使用nginx代理，下面就是方法

#### 用的是阿里的域名，添加二级域名如下图
![](https://sweetm-1256061026.cos.ap-beijing.myqcloud.com/2018-02-12-git%E6%9C%8D%E5%8A%A1%E5%99%A8gogs%E5%AE%89%E8%A3%85/%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D)
在nginx目录下配置,添加如下文件

```
[root@sweet ~]# cd /etc/nginx/conf.d/
[root@sweet conf.d]# vim gogs.conf
```
gogs.conf 内配置的内容为：

```
server {
    server_name git.sweetm.top;
    listen 80;
    #ssl on;

    location /{
        proxy_pass http://127.0.0.1:3000/;
        proxy_redirect default;
    }
}
```
然后就是我们大功告成了！














